<mat-card class="max-h-[calc(100vh-130px)] w-full">
    @if (loading) {
    <mat-progress-bar mode="indeterminate" />
    } @else {
    <mat-card-content class="pb-4">
        <!-- Create Review Form -->
        @if (showCreateForm) {
        <mat-card class="mb-6">
            <mat-card-header>
                <mat-card-title>Create New Review</mat-card-title>
                <div class="ml-auto">
                    <button mat-icon-button (click)="cancelCreateReview()" matTooltip="Cancel">
                        <mat-icon>close</mat-icon>
                    </button>
                </div>
            </mat-card-header>
            <mat-card-content>
                <app-review 
                    [data]="getNewReviewData()" 
                    [isCreating]="true"
                    (reviewCreated)="onReviewCreated()">
                </app-review>
            </mat-card-content>
        </mat-card>
        }

        <!-- Existing Reviews -->
        <mat-accordion>
            @for (review of reviews; track trackByReviewId(idx, review); let idx = $index) {
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        Review #{{idx + 1}}
                        <i class="text-gray-400 ml-4">posted {{formatTime(review.createdAt)}}</i>
                    </mat-panel-title>
                    <mat-panel-description>
                        open to see review details
                    </mat-panel-description>
                </mat-expansion-panel-header>
                <app-review [data]="review" />
            </mat-expansion-panel>
            } @empty {
            <p>No review yet.</p>
            }
        </mat-accordion>
    </mat-card-content>
    }
</mat-card>
